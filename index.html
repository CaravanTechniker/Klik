<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CaravanTechniker am Main – Wohnmobil Diagnose</title>

<style>
:root{
  --bg:#b9d7f0;
  --card:#eaf4ff;
  --stroke:#c7d9ea;
  --text:#0b1a2a;
  --muted:#4c5a6a;
  --tag:#d7ecff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,var(--bg),#d8ecff);
  color:var(--text)
}
.wrap{max-width:1200px;margin:16px auto;padding:0 12px}
.top{
  display:flex;justify-content:space-between;flex-wrap:wrap;gap:12px
}
.brand{font-size:30px;font-weight:900}
.brand small{display:block;font-size:14px;opacity:.75}

.pill{padding:10px 16px;border-radius:999px;border:1px solid var(--stroke);
background:#fff;font-weight:800;cursor:pointer}
.pills{display:flex;gap:8px;flex-wrap:wrap}

.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:14px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:16px
}
h2{margin:0 0 6px;font-size:26px}
.sub{color:var(--muted);margin-bottom:10px}

.search{display:flex;gap:8px}
.search input{
  flex:1;padding:12px;border-radius:999px;border:1px solid var(--stroke)
}

.chips{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
.chip{
  background:var(--tag);
  border:1px solid var(--stroke);
  border-radius:999px;
  padding:6px 12px;
  font-weight:800;
  cursor:pointer
}
.chip.active{outline:3px solid rgba(0,0,0,.15)}

.list{display:flex;flex-direction:column;gap:8px}
.item{
  background:#fff;
  border:1px solid var(--stroke);
  border-radius:14px;
  padding:12px;
  cursor:pointer
}
.item b{font-size:17px}
.item span{display:block;color:var(--muted)}

.big{
  width:100%;padding:16px;border-radius:16px;
  border:none;font-size:22px;font-weight:900;cursor:pointer
}
.yes{background:#177a3a;color:#fff}
.no{background:#b21818;color:#fff}
.back{background:#f2c20e;color:#000;margin-top:10px}

textarea{
  width:100%;min-height:160px;
  background:#cfe7fb;border:1px solid var(--stroke);
  border-radius:12px;padding:12px
}
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      CaravanTechniker am Main
      <small id="brandSub"></small>
    </div>
    <div class="pills">
      <div class="pill" id="langDE">DE</div>
      <div class="pill" id="langSK">SK</div>
      <div class="pill" id="adminBtn">ADMIN</div>
      <div class="pill" id="resetBtn">RESET</div>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2 id="hFaults"></h2>
      <div class="search">
        <input id="search">
      </div>
      <div class="chips" id="categoryChips"></div>
      <div class="list" id="faultList"></div>
    </div>

    <div class="card">
      <h2 id="hDiag"></h2>
      <p class="sub" id="nodeText"></p>
      <button class="big yes" id="yesBtn">ÁNO</button>
      <button class="big no" id="noBtn">NIE</button>
      <button class="big back" id="backBtn">← SPÄŤ</button>
      <textarea id="proto" readonly></textarea>
      <button class="pill" id="pdfBtn">PDF</button>
    </div>
  </div>
</div>

<script>
const I={
de:{sub:"Wohnmobil Diagnose",faults:"Störungen",diag:"Diagnose"},
sk:{sub:"Diagnostika obytných vozidiel",faults:"Poruchy",diag:"Diagnostika"}
};
let LANG=localStorage.lang||"de";
let TREES=[],tree=null,node=null,path=[],cat="";

function L(x){return typeof x==="object"?x[LANG]:x}
function applyLang(){
  brandSub.textContent=I[LANG].sub;
  hFaults.textContent=I[LANG].faults;
  hDiag.textContent=I[LANG].diag;
}

async function load(){
  const r=await fetch("content.json");
  const d=await r.json();
  TREES=d.trees||d;
  renderCats();renderList()
}

function renderCats(){
  categoryChips.innerHTML="";
  [...new Set(TREES.map(t=>t.category?.key))].forEach(k=>{
    if(!k)return;
    const b=document.createElement("div");
    b.className="chip"+(cat===k?" active":"");
    b.textContent=L(TREES.find(t=>t.category.key===k).category.label);
    b.onclick=()=>{cat=cat===k?"":k;renderCats();renderList()};
    categoryChips.appendChild(b);
  })
}

function renderList(){
  faultList.innerHTML="";
  TREES.filter(t=>!cat||t.category.key===cat)
    .forEach(t=>{
      const d=document.createElement("div");
      d.className="item";
      d.innerHTML=`<b>${L(t.title)}</b><span>${L(t.subtitle)}</span>`;
      d.onclick=()=>{tree=t;node=t.nodes[t.start];path=[];renderNode()};
      faultList.appendChild(d);
    })
}

function renderNode(){
  nodeText.textContent=L(node.text||node.cause||"");
  proto.value=path.map(p=>p.q+" "+p.a).join("\n");
}

yesBtn.onclick=()=>{path.push({q:L(node.text),a:"[YES]"});node=tree.nodes[node.yes];renderNode()}
noBtn.onclick=()=>{path.push({q:L(node.text),a:"[NO]"});node=tree.nodes[node.no];renderNode()}
backBtn.onclick=()=>{location.reload()}
langDE.onclick=()=>{LANG="de";localStorage.lang="de";applyLang()}
langSK.onclick=()=>{LANG="sk";localStorage.lang="sk";applyLang()}
resetBtn.onclick=()=>{localStorage.clear();location.reload()}
adminBtn.onclick=()=>alert("ADMIN IMPORT cez pôvodnú verziu")

applyLang();load();
</script>
</body>
</html>
